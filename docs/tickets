ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-001
TITEL: Aufgaben vom Tag fehlen in Aufgaben√ºbersicht
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Aufgaben, die heute erstellt werden, tauchen nicht in der Aufgaben√ºbersicht auf.
- Soll: Neue Aufgaben m√ºssen sofort in der Aufgaben√ºbersicht erscheinen.
- Kontext: Aufgabenverwaltung / Aufgaben√ºbersicht.

ROOT CAUSE: aufgaben-content.jsx:77 verwendet toISOString().split('T')[0] ‚Üí UTC-Konvertierung verschiebt Datum.

L√ñSUNG: Lokale formatLocalDate() Helper verwendet statt toISOString().

SCOPE-FENCE:
- Erlaubt: aufgaben-content.jsx Zeile 77 √§ndern
- Erlaubt: Lokale formatDate() Helper oder Import aus use-dashboard.js
- Verboten: Globale Date-Utils refactoren
- Verboten: Andere Komponenten √§ndern

CHANGE-BUDGET: 1 Datei, max 10 Zeilen.

VORGEHEN:
1) Ursache nennen.
2) Minimal Patch vorschlagen.
3) Patch implementieren als kleinen Diff.
4) Manuelle Tests (mind 4 Schritte).
5) Optional 1 kleiner Test.

AKZEPTANZ:
- Neue Aufgabe erscheint direkt ohne Reload.
- Filter Datum Heute zeigt sie zuverl√§ssig.
- Keine √Ñnderung am Verhalten f√ºr andere Tage.






ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-002
TITEL: Lernblock Aufgaben werden nicht in To Do/Verwaltung gelistet
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Aufgabe im Lernblock erstellt erscheint weder links in To Do noch unter Verwaltung Aufgaben√ºbersicht.
- Soll: Lernblock Aufgaben werden wie normale Aufgaben synchron in allen Listen angezeigt.
- Kontext: Lernblock Editor -> Task Aggregation.

ROOT CAUSE: Block-Tasks in block.tasks[] (calendar_blocks), Dashboard liest nur tasksByDate (calendar_tasks). Zwei isolierte Systeme.

L√ñSUNG: Read-side aggregation in aufgaben-content.jsx und use-dashboard.js - Block-Tasks werden aus blocksByDate extrahiert und mit tasksByDate zusammengef√ºhrt.

SCOPE-FENCE:
- Erlaubt: Dashboard/Verwaltung Tasks aus blocksByDate aggregieren (read-side fix)
- Erlaubt: use-dashboard.js und aufgaben-content.jsx erweitern
- Verboten: Block-Task-Erstellung √§ndern
- Verboten: Neues Sync-System einf√ºhren
- Verboten: calendar_tasks Tabelle f√ºr Block-Tasks nutzen

CHANGE-BUDGET: 2 Dateien, max 50 Zeilen.

VORGEHEN: Ursache, minimaler Patch, Diff, Tests, optional Test.

AKZEPTANZ:
- Lernblock Aufgabe erscheint sofort in To Do.
- Lernblock Aufgabe erscheint unter Verwaltung.
- Keine Duplikate, keine falschen F√§lligkeiten.






ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-003
TITEL: Navigation/Verkn√ºpfung Monat Woche Tagesansicht inkonsistent
TYP: Bug
PRIORIT√ÑT: P1
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Verkn√ºpfung zwischen Monat, Wochen, Tagesansicht ist fehlerhaft oder springt falsch.
- Soll: Wechsel zwischen Ansichten beh√§lt das ausgew√§hlte Datum konsistent bei.
- Kontext: Kalender.

ROOT CAUSE ANALYSE:
- navigation.jsx:59-62: Submenu Links verwenden statische Routen ohne Datum-Parameter
  - `/kalender/woche` und `/kalender/monat` ohne Query-String
- calendar-view.jsx:29: currentDate State ist lokal, wird nicht zwischen Views geteilt
- week-view.jsx: Gleiches Problem - kein geteilter Datums-State

L√ñSUNG (27.01.2026 - Option A: Query-Parameter):

1. **navigation.jsx**: Liest `?date=` aus URL und f√ºgt es an Kalender-Submenu-Links an
   - useSearchParams Hook f√ºr URL-Parameter
   - Dynamische Links: `/kalender/woche?date=YYYY-MM-DD`

2. **calendar-view.jsx**: Liest und schreibt Datum in URL
   - useSearchParams + useEffect f√ºr URL-Sync
   - getInitialDate() liest `?date=` Parameter
   - useEffect aktualisiert URL bei Navigation

3. **week-view.jsx**: Identische Implementierung wie calendar-view.jsx
   - useSearchParams + useEffect f√ºr URL-Sync

BETROFFENE DATEIEN:
- src/components/layout/navigation.jsx (Zeilen 2, 17, 64-66)
- src/features/calendar/components/calendar-view.jsx (Zeilen 1-2, 28-43)
- src/features/calendar/components/week-view.jsx (Zeilen 1-2, 24-43)

AKZEPTANZ:
- ‚úÖ Datum bleibt beim Wechsel konsistent (via URL Query-Parameter).
- ‚úÖ Zur√ºck Navigation f√ºhrt zum erwarteten Datum (Browser-History).
- ‚úÖ Direktlinks mit Datum m√∂glich (z.B. /kalender/woche?date=2026-03-15).










ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-005
TITEL: Timer l√§uft bei Background/Screen Sync nicht zuverl√§ssig weiter
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (T16-W3)

PROBLEM:
- Ist: Timer stoppt oder driftet, wenn Tab inaktiv ist oder Screen Sync.
- Soll: Timer basiert auf Timestamps (Startzeit + elapsed) und bleibt korrekt.
- Kontext: Timer/Stoppuhr.

L√ñSUNG (implementiert):
- Timer verwendet timestamp-basierte Berechnung (nicht Interval-Counting)
- Visibility Change Handler implementiert (recalculates bei Tab-Wechsel)
- localStorage + Supabase Persistenz f√ºr Restart-Szenarios
- Betroffene Datei: src/contexts/timer-context.jsx (Zeilen 392-396, 413-422, 652-673)

KEINE AKTION ERFORDERLICH.





ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-006
TITEL: Neuer Termin √ºbernimmt Uhrzeit des angeklickten Zeitfensters
TYP: UX
PRIORIT√ÑT: P1
STATUS: DUPLIKAT von PW-014

PROBLEM:
- Ist: Neuer Termin setzt Uhrzeit nicht passend zum angeklickten Slot.
- Soll: Klick auf Slot setzt Startzeit = Slot Start, Endzeit default = +X Minuten.
- Kontext: Kalender Slot Klick Create Event.

EMPFEHLUNG: PW-006 schlie√üen, PW-014 behalten. Identische Root Cause.





ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-007
TITEL: Lernblock Rechtsgebiet nicht mit User Settings verbunden
TYP: Bug/UX
PRIORIT√ÑT: P1
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Rechtsgebiet-Dropdown existiert, aber ist NICHT mit User Settings verbunden.
  - Widget √ºbernimmt nicht die Farbe aus den User Settings
  - Manuelle Auswahl wird nicht persistiert/synchronisiert
- Soll: Lernblock-Widget √ºbernimmt automatisch die Rechtsgebiet-Farbe aus den User Settings.
- Kontext: Lernblock Create Modal / Day View / User Settings Integration.

L√ñSUNG (27.01.2026):
1. Farben waren BEREITS mit User Settings verbunden via getRechtsgebietColor() ‚Üí getColorForSubject() ‚Üí getSubjectSettings()
2. Das eigentliche Problem: Kein Default-Rechtsgebiet beim √ñffnen des Dialogs
3. Fix: LocalStorage Key 'prepwell_default_rechtsgebiet' speichert zuletzt verwendetes Rechtsgebiet
   - Beim √ñffnen: Letztes Rechtsgebiet als Default laden (falls es noch existiert)
   - Beim Speichern: Ausgew√§hltes Rechtsgebiet f√ºr n√§chstes Mal merken

BETROFFENE DATEIEN:
- src/features/calendar/components/create-theme-session-dialog.jsx
  - Zeile 19: STORAGE_KEY_DEFAULT_RECHTSGEBIET Konstante
  - Zeilen 99-109: Default aus localStorage laden
  - Zeilen 352-357: Auswahl in localStorage speichern

AKZEPTANZ:
- ‚úÖ Rechtsgebiet-Default kommt aus zuletzt verwendeter Auswahl.
- ‚úÖ Farbe wird aus Settings √ºbernommen (via getRechtsgebietColor).
- ‚úÖ Bei √Ñnderung wird korrekte Farbe sofort angezeigt.
- ‚úÖ Bestehende Lernbl√∂cke bleiben korrekt.





ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-008
TITEL: Globale Play/Pause Controls f√ºr Stoppuhr
TYP: UX
PRIORIT√ÑT: P2
STATUS: ‚úÖ GEFIXT (T16-W6)

PROBLEM:
- Ist: Play/Pause nur in Timer Ansicht erreichbar.
- Soll: Oben im Header globale Controls (nur f√ºr Stoppuhr) sichtbar wenn aktiv.
- Kontext: Header/Navigation.

L√ñSUNG (bereits implementiert als T16-W6):
- dashboard-sub-header.jsx:143-146: handlePlayPause Funktion
- dashboard-sub-header.jsx:170-190: Play/Pause Button erscheint bei Hover √ºber TimerWidget
- timer-display.jsx:62-66, 124-144: Gleiche Implementierung

IMPLEMENTATION DETAILS:
- isHovered State (dashboard-sub-header.jsx:83)
- togglePause() aus useTimer Hook (dashboard-sub-header.jsx:80)
- Button mit Play/Pause Icons (dashboard-sub-header.jsx:177-188)

KEINE AKTION ERFORDERLICH.






ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-009
TITEL: Sekundenanzeige bei Hover + Timer Dialog
TYP: UX
PRIORIT√ÑT: P2
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Keine Sekunden sichtbar, Bewegung schwer erkennbar.
- Soll: Sekunden bei Hover √ºber Timer im Sub-Header UND im ge√∂ffneten Timer Dialog.
- Kontext: Dashboard Sub-Header + Timer Dialog.

ANFORDERUNG (korrigiert 27.01.2026):
1. **Sub-Header Hover:** Sekunden erscheinen wenn man √ºber die Timer-Anzeige hovert
2. **Timer Dialog:** Sekunden werden immer angezeigt wenn Dialog offen ist

CODE ANALYSE:

**A) Dashboard Sub-Header (Hover f√ºr Sekunden)**
- dashboard-sub-header.jsx:80 - useTimer gibt `elapsedSeconds`/`remainingSeconds` zur√ºck
- dashboard-sub-header.jsx:83 - `isHovered` State existiert bereits!
- dashboard-sub-header.jsx:120-131 - `getTimerLabel()` zeigt aktuell `primaryText` (ohne Sekunden)

**B) Timer Main Dialog (Sekunden immer)**
- timer-main-dialog.jsx:269-277 - `formatTime()` (Pomodoro/Countdown)
- timer-main-dialog.jsx:477-484 - `CountupTimerView.timeDisplay` (Stoppuhr)

SCOPE-FENCE:
- Erlaubt: src/components/dashboard/dashboard-sub-header.jsx
  - Zeile 80: `elapsedSeconds`, `remainingSeconds` aus useTimer() holen
  - Zeilen 120-131: `getTimerLabel()` um Hover-Logik erweitern
  - Neue Helper: `formatSecondsWithSecs()` f√ºr Sekunden-Format
- Erlaubt: src/components/dashboard/timer/timer-main-dialog.jsx
  - formatTime() Zeilen 269-277 anpassen
  - CountupTimerView timeDisplay Zeilen 477-484 anpassen
- Verboten: src/contexts/timer-context.jsx (bleibt unver√§ndert)

VORGESCHLAGENE L√ñSUNG:

```js
// === dashboard-sub-header.jsx ===

// Zeile 80: Erweiterte Destructuring
const { timerType, isActive, getDisplayInfo, togglePause,
        elapsedSeconds, remainingSeconds, state: _state } = useTimer();

// Neue Helper-Funktion
const formatWithSeconds = (totalSeconds) => {
  const hrs = Math.floor(totalSeconds / 3600);
  const mins = Math.floor((totalSeconds % 3600) / 60);
  const secs = totalSeconds % 60;
  if (hrs > 0) {
    return `${hrs}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
  }
  return `${mins}:${secs.toString().padStart(2,'0')}`;
};

// getTimerLabel() mit Hover-Logik
const getTimerLabel = () => {
  // Bei Hover: Sekunden anzeigen
  if (isHovered) {
    switch (timerType) {
      case TIMER_TYPES.POMODORO:
      case TIMER_TYPES.COUNTDOWN:
        return formatWithSeconds(remainingSeconds);
      case TIMER_TYPES.COUNTUP:
        return formatWithSeconds(elapsedSeconds);
    }
  }
  // Normal: primaryText ohne Sekunden
  return primaryText;
};
```

```js
// === timer-main-dialog.jsx ===

// formatTime() mit Sekunden (Zeilen 269-277)
const formatTime = (seconds) => {
  const hrs = Math.floor(seconds / 3600);
  const mins = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  if (hrs > 0) {
    return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  return `${mins}:${secs.toString().padStart(2, '0')}`;
};

// CountupTimerView timeDisplay (Zeilen 477-484)
const timeDisplay = useMemo(() => {
  const hrs = Math.floor(elapsedSeconds / 3600);
  const mins = Math.floor((elapsedSeconds % 3600) / 60);
  const secs = elapsedSeconds % 60;
  if (hrs > 0) {
    return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}, [elapsedSeconds]);
```

CHANGE-BUDGET: 2 Dateien, max 40 Zeilen.

AKZEPTANZ:
- Sub-Header: Bei Hover √ºber Timer-Anzeige erscheinen Sekunden (z.B. "12:34").
- Sub-Header: Ohne Hover bleibt normale Anzeige ("6h 22min gelernt").
- Timer Dialog: Zeigt immer Sekunden wenn offen.
- Circular Progress Ring aktualisiert sich jede Sekunde.










ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-011
TITEL: Check-In Button Visibility Logik unvollst√§ndig
TYP: Bug/UX
PRIORIT√ÑT: P1
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Check-In Button zeigte "erledigt" Status statt zu verschwinden.
- Soll: Button verschwindet nach Erledigung, bleibt sichtbar wenn √ºbersprungen.
- Kontext: Dashboard Sub-Header / Check-In System.

L√ñSUNG (27.01.2026):
Komplette √úberarbeitung von getCheckInButton() in dashboard-sub-header.jsx:

1. **All done ‚Üí null**: Wenn alle erwarteten Check-Ins erledigt sind, verschwindet Button
2. **Morning done in morning period ‚Üí null**: Nach Morgen-Check-In verschwindet Button
3. **Evening done in evening period ‚Üí null**: Nach Abend-Check-In verschwindet Button
4. **Morning skipped ‚Üí "Morgen-Check-in nachholen"**: Klickbarer Button zum Nachholen
5. **Evening skipped ‚Üí "Abend-Check-in nachholen"**: Klickbarer Button zum Nachholen
6. **Evening period, rules not met ‚Üí disabled**: Grau, nicht klickbar
7. **Active period ‚Üí button**: Normaler aktiver Button

BEREITS KORREKT IMPLEMENTIERT:
- ‚úÖ Mentor AUS ‚Üí Button unsichtbar (isMentorActivated && getCheckInButton())
- ‚úÖ Auto-Redirect bei Login (dashboard.jsx:93-100 via isCheckInNeeded)
- ‚úÖ checkInCount (1 oder 2) aus Settings (checkin-context.jsx)
- ‚úÖ morningSkipped/eveningSkipped Status (use-dashboard.js)

BETROFFENE DATEIEN:
- src/components/dashboard/dashboard-sub-header.jsx
  - getCheckInButton() komplett √ºberarbeitet (Zeilen 281-336)
  - Alte Hilfsfunktionen entfernt (renderCheckIcon, getCheckInStatusLabel, getSkippedLabel)

AKZEPTANZ:
- ‚úÖ Mentor AUS ‚Üí Button unsichtbar.
- ‚úÖ Mentor AN + 2 Check-Ins ‚Üí Morgen-Dialog √∂ffnet bei Login automatisch (via redirect).
- ‚úÖ Nach Erledigung ‚Üí Button verschwindet bis n√§chste Regel greift.
- ‚úÖ √úbersprungen ‚Üí Button bleibt sichtbar mit "nachholen" Text.






ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-012
TITEL: Gro√üer Start Button startet Timer nicht
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT

PROBLEM:
- Ist: Start Button oben startet Timer nicht, nur √ºber Einstellungen Klick.
- Soll: Start Button l√∂st exakt dieselbe Start Aktion aus wie der funktionierende Weg.
- Kontext: Timer Start CTA.

L√ñSUNG (implementiert):
- Start Button in ConfiguredIdleState (timer-main-dialog.jsx:910-940)
- Ruft startFromConfig() korrekt auf
- startFromConfig() liest frische Config aus localStorage (BUG-015 Fix)
- Setzt timerState = TIMER_STATES.RUNNING korrekt

KEINE AKTION ERFORDERLICH.






ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-013
TITEL: Tagesziel reset und Anzeige "Tagesziel erreicht" korrekt
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Tagesziel resettiert nicht, zeigt Zeit von gestern. Anzeige "Tagesziel erreicht -> 7:54" wirkt wie aktuelle Uhrzeit.
- Soll: Reset t√§glich korrekt. Anzeige zeigt Zeitpunkt des Zielerreichens oder klar benannt.
- Kontext: Tagesziel Tracking.

ROOT CAUSE: dashboard-sub-header.jsx:136 zeigt currentTime (updates jede Sekunde)

L√ñSUNG: Verwirrende Zeit entfernt - zeigt jetzt nur "Tagesziel erreicht" ohne aktuelle Uhrzeit.
- dashboard-sub-header.jsx: secondaryText statt currentTime verwendet
- timer-context.jsx: COUNTUP secondaryText ohne Zeit

SCOPE-FENCE:
- Erlaubt: dashboard-sub-header.jsx Zeile 136 √§ndern
- Erlaubt: timer-context.jsx secondaryText Berechnung anpassen
- Verboten: Reset-Logik √§ndern (funktioniert bereits)
- Verboten: Neue State-Variablen f√ºr "Zielerreichungszeit"

CHANGE-BUDGET: 2 Dateien, max 20 Zeilen.

AKZEPTANZ:
- Anzeige nicht mehr verwirrend
- Reset erfolgt bei Tageswechsel korrekt
- Keine Datenverluste





ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-014
TITEL: Slot Klick setzt Uhrzeit f√§lschlich auf 09:00, Drag korrekt
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Klick auf Zeitfenster erzeugt Termin mit 09:00. Drag erzeugt korrekte Zeit.
- Soll: Klick √ºbernimmt Slot Startzeit, analog zu Drag Default.
- Kontext: Semesterbetrieb √úbungsklausur/Klausur auf Startseite.

ROOT CAUSE:
- Click-Handler: Math.floor(y / hourHeight) ‚Üí rundet auf ganze Stunde
- Drag-Handler: yToTime(y) ‚Üí 15-Minuten-Snapping

L√ñSUNG: Click-Handler verwendet jetzt yToTime() + formatTimeFromHour() wie Drag-Handler.

SCOPE-FENCE:
- Erlaubt: week-grid.jsx Click-Handler (Zeile 924-932) anpassen
- Erlaubt: yToTime() Funktion wiederverwenden
- Verboten: Drag-Handler √§ndern
- Verboten: Dialog-Komponenten √§ndern

CHANGE-BUDGET: 1 Datei, max 15 Zeilen.

AKZEPTANZ:
- Klick erzeugt Termin mit korrekter Startzeit (15-Min-Pr√§zision).
- Drag bleibt unver√§ndert.
- Keine √Ñnderung anderer Default Zeiten.







ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-015
TITEL: Themenplan Erstellung √ºber Screenshot
TYP: Feature
PRIORIT√ÑT: P2

PROBLEM:
- Ist: Kein Weg, aus Screenshot einen Themenplan zu erzeugen.
- Soll: MVP: Upload Screenshot -> extrahiere Text -> erstelle Themenliste -> Nutzer kann bearbeiten -> speichern.
- Kontext: Themenplan.

TECHNISCHE ANALYSE (27.01.2026):
- Betroffene Dateien:
  - src/pages/lernplan.jsx - Lernplan √úbersicht (Einstiegspunkt)
  - src/features/themenliste/ - Themenliste Feature Module
  - src/features/themenliste/components/themenliste-header.jsx - Kann Button f√ºr Upload enthalten

MVP VORSCHLAG:
1) Neuer Button "Aus Screenshot importieren" in Lernplan-Seite
2) Neue Komponente: src/features/themenliste/components/screenshot-import-dialog.jsx
3) Browser File API f√ºr Bildupload (kein Backend n√∂tig f√ºr Phase 1)
4) OCR Option A: Tesseract.js (client-side, ~2MB Bundle)
5) OCR Option B: Cloud Vision API (erfordert API Key)
6) Parsed Text ‚Üí Themenliste Struktur konvertieren

SCOPE-FENCE:
- Erlaubt: src/pages/lernplan.jsx (Button hinzuf√ºgen)
- Erlaubt: Neues src/features/themenliste/components/screenshot-import-dialog.jsx
- Erlaubt: src/contexts/calendar-context.jsx saveContent verwenden
- Erlaubt: Package hinzuf√ºgen: tesseract.js (f√ºr client-side OCR)
- Verboten: Kein komplettes Redesign Themenplan
- Verboten: Keine neue Architektur

CHANGE-BUDGET: Max 5 Dateien, max 250 Zeilen.

VORGEHEN:
1) Vorschlag f√ºr kleinsten MVP.
2) Implementiere nur MVP.
3) Manuelle Tests.

AKZEPTANZ:
- Screenshot Upload m√∂glich.
- Ergebnis als editierbare Liste.
- Speichern funktioniert.




ROLE: Senior Engineer. Minimal Change.

TICKET-ID: PW-016
TITEL: Klick auf Zeitfenster setzt Endzeit VOR Startzeit
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist: Bei Klick auf Zeitfenster wird Endzeit auf einen vorherigen Wert gesetzt (vor der Startzeit).
- Soll: Endzeit soll 30 Minuten NACH der Startzeit sein bei einfachem Klick.
- Kontext: Wochenansicht Kalender, Klick auf leeres Zeitfenster.

ROOT CAUSE ANALYSE:

**Ablauf bei Drag (funktioniert korrekt):**
```
handleTimeRangeSelect() ‚Üí setzt BEIDE:
  - setSelectedTime(startTime)
  - setSelectedEndTime(endTime)
```

**Ablauf bei Klick (BUG):**
```
handleTimeBlockClick() ‚Üí setzt NUR:
  - setSelectedTime(time)
  - selectedEndTime bleibt UNVER√ÑNDERT (alter Wert von vorherigem Drag!)
```

**Dialog-Verhalten:**
```javascript
// create-theme-session-dialog.jsx:92-93
setStartTime(initialStartTime || '09:00');
setEndTime(initialEndTime || '11:00');  // ‚Üê Wenn initialEndTime != null, wird alter Wert verwendet!
```

**Beispiel des Bugs:**
1. User macht Drag von 14:00 ‚Üí 16:00 ‚Üí selectedEndTime = "16:00"
2. User schlie√üt Dialog ohne zu speichern
3. User klickt auf 10:00 ‚Üí selectedTime = "10:00", selectedEndTime bleibt "16:00"
4. Dialog √∂ffnet mit Start: 10:00, Ende: 16:00 ‚Üí falsch!

**Schlimmster Fall:**
1. User macht Drag von 08:00 ‚Üí 09:00 ‚Üí selectedEndTime = "09:00"
2. User klickt auf 14:00 ‚Üí Dialog zeigt Start: 14:00, Ende: 09:00 ‚Üí Ende VOR Start!

SCOPE-FENCE:

**√Ñnderungsort:**
- Datei: `src/features/calendar/components/week-view.jsx`
- Funktion: `handleTimeBlockClick` (Zeilen 317-321)
- Aktueller Code:
```javascript
// Zeile 317-321
const handleTimeBlockClick = (date, time) => {
  setSelectedDate(date);
  setSelectedTime(time);
  setIsAddDialogOpen(true);
};
```

**Erlaubt:**
- Zeilen 317-321: `setSelectedEndTime()` Aufruf hinzuf√ºgen
- Inline-Berechnung f√ºr Endzeit (startTime + 30min)

**Verboten:**
- `handleTimeRangeSelect` (Zeilen 562-572) - Drag-Handler funktioniert korrekt
- Dialog-Komponenten (create-theme-session-dialog.jsx, etc.)
- State-Deklarationen (Zeilen 54-55)

VORGESCHLAGENE L√ñSUNG:

```javascript
// week-view.jsx - handleTimeBlockClick (Zeile 317-321)
const handleTimeBlockClick = (date, time) => {
  setSelectedDate(date);
  setSelectedTime(time);
  // PW-016 Fix: Set default end time to 30 minutes after start
  const [hours, mins] = time.split(':').map(Number);
  const totalMins = hours * 60 + mins + 30; // +30 Minuten
  const endHours = Math.floor(totalMins / 60);
  const endMins = totalMins % 60;
  const endTime = `${String(endHours).padStart(2, '0')}:${String(endMins).padStart(2, '0')}`;
  setSelectedEndTime(endTime);
  setIsAddDialogOpen(true);
};
```

CHANGE-BUDGET: 1 Datei, max 15 Zeilen.

AKZEPTANZ:
- Klick auf Zeitfenster: Endzeit = Startzeit + 30 Minuten.
- Drag bleibt unver√§ndert (eigene Berechnung).
- Dialog zeigt korrekte Zeiten bei Klick UND Drag.




================================================================================
                        P0 ZUSAMMENFASSUNG (27.01.2026)
================================================================================

P0 STATUS:

| Ticket | Status | Beschreibung |
|--------|--------|--------------|
| PW-001 | ‚úÖ GEFIXT | UTC date fix in aufgaben-content.jsx |
| PW-002 | ‚úÖ GEFIXT | Block-Tasks Aggregation |
| PW-005 | ‚úÖ GEFIXT | T16-W3 (bereits vorher) |
| PW-006 | DUPLIKAT | ‚Üí PW-014 |
| PW-012 | ‚úÖ GEFIXT | (bereits vorher) |
| PW-013 | ‚úÖ GEFIXT | Display fix ohne verwirrende Zeit |
| PW-014 | ‚úÖ GEFIXT | yToTime() f√ºr 15-Min-Pr√§zision (Startzeit) |
| PW-016 | ‚úÖ GEFIXT | Endzeit bei Klick = Startzeit + 30min |


================================================================================
                        P1/P2 STATUS (27.01.2026)
================================================================================

P1 TICKETS:
| Ticket | Status | Beschreibung |
|--------|--------|--------------|
| PW-003 | ‚úÖ GEFIXT | Navigation Monat/Woche/Tag - URL Query-Parameter Sync |
| PW-007 | ‚úÖ GEFIXT | Rechtsgebiet Default aus localStorage |
| PW-011 | ‚úÖ GEFIXT | Check-In Button verschwindet nach Erledigung |
| PW-017 | ‚úÖ GEFIXT | Dead Code entfernt - kalenderApi, useBlocks, /slots Endpoints |
| PW-018 | ‚úÖ GEFIXT | Wizard-Complete Payload/Response Drift DEV/PROD |
| PW-021 | OFFEN | Themenlisten Toggle zeigt keine Aufgaben |

P2 TICKETS:
| Ticket | Status | Beschreibung |
|--------|--------|--------------|
| PW-004 | ‚úÖ GEL√ñSCHT | Sekunden im Tagesplaner - bereits gefixt |
| PW-008 | ‚úÖ GEFIXT (T16-W6) | Global Play/Pause - bereits implementiert |
| PW-009 | ‚úÖ GEFIXT | Sekunden bei Hover + im Timer Dialog |
| PW-010 | ‚úÖ GEL√ñSCHT | Sekunden in Wochenansicht - bereits gefixt |
| PW-015 | OFFEN | Screenshot ‚Üí Themenplan Feature |
| PW-019 | ‚úÖ GEFIXT | /api/health Endpoint hinzugef√ºgt (DEV + PROD) |
| PW-020 | ‚úÖ GEFIXT | Auth-Debug Logging nur in DEV aktiv |
| PW-022 | OFFEN | Check-ins Settings: nur abends / deaktivieren |



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-017
TITEL: Dead Code bereinigen: Ungenutzte kalenderApi und server.js /slots Endpoints
TYP: Housekeeping
PRIORIT√ÑT: P3
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM (AKTUALISIERT 27.01.2026):
- Urspr√ºngliche Annahme: /blocks Endpoint liefert 404 in DEV ‚Üí Monatsansicht kaputt
- **Realit√§t**: Die Monatsansicht nutzt NICHT den lokalen Server!

ARCHITEKTUR-ANALYSE:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    TATS√ÑCHLICHER DATENFLUSS                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                          ‚îÇ
‚îÇ  CalendarContext (calendar-context.jsx)                                  ‚îÇ
‚îÇ       ‚îÇ                                                                  ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ useCalendarBlocksSync()  ‚îÄ‚îÄ‚Üí  Supabase: calendar_blocks       ‚îÇ
‚îÇ       ‚îÇ   (Monatsansicht Bl√∂cke)        Position-basiert, KEINE Zeiten  ‚îÇ
‚îÇ       ‚îÇ                                                                  ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ useTimeSessionsSync()    ‚îÄ‚îÄ‚Üí  Supabase: time_sessions         ‚îÇ
‚îÇ       ‚îÇ   (Woche/Startseite)            Zeit-basiert (start_at, end_at) ‚îÇ
‚îÇ       ‚îÇ                                                                  ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ usePrivateSessionsSync() ‚îÄ‚îÄ‚Üí  Supabase: private_sessions      ‚îÇ
‚îÇ           (Private Termine)             Zeit-basiert (start_at, end_at) ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  KEIN Aufruf von kalenderApi oder server.js /slots Endpoints!           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

L√ñSUNG (27.01.2026 - Dead Code Cleanup):
Dead Code wurde entfernt:
1. ‚úÖ **api.ts** - `kalenderApi` Export und Section entfernt (Zeilen 161-186)
2. ‚úÖ **api.ts** - `kalender: kalenderApi` aus Combined Export entfernt
3. ‚úÖ **useApi.ts** - `kalenderApi` Import entfernt
4. ‚úÖ **useApi.ts** - `useBlocks` Hook entfernt (war nie verwendet)
5. ‚úÖ **server.js** - 4 `/slots` Endpoints entfernt (GET/PUT/POST/POST bulk)
   - Kommentar hinzugef√ºgt zur Erkl√§rung des Datenflusses

HINWEIS: `slotsData` in server.js bleibt erhalten, da:
- Wizard-Complete Endpoint (Zeile 518) speichert generierte Slots
- DELETE Lernplaene (Zeile 656) r√§umt Slots auf

CHANGE-BUDGET: 3 Dateien, ~150 Zeilen entfernt

AKZEPTANZKRITERIEN:
- ‚úÖ Dead Code entfernt
- ‚úÖ Architektur-Dokumentation im Ticket aktualisiert
- ‚úÖ Keine Funktionalit√§ts-Regression (CalendarContext unver√§ndert)



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-018
TITEL: Wizard-Complete Payload/Response Drift zwischen DEV und PROD
TYP: Bug
PRIORIT√ÑT: P1
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist-Zustand: `wizard-context.jsx` sendet unterschiedliche Payloads (teilweise flach, teilweise { wizardData, lernplanTitle }). In PROD erwartet `/api/wizard/complete` `{wizardData, lernplanTitle}`, im DEV erwartet `server.js` flache Felder. Zus√§tzlich fehlt im DEV die `data`-Wrapper-Struktur, wodurch `result.data` undefined ist.
- Soll-Zustand: Alle Wizard-Flows senden dieselbe Payload (kanonisch `{ wizardData, lernplanTitle, lernplanDescription }`) und DEV/PROD liefern konsistent `{ success, data }`.
- Kontext: Lernplan Wizard ‚Äì Complete/Template/Automatic Flow.

ROOT CAUSE ANALYSE:
1. **wizard-context.jsx:1153-1157** - Frontend sendet:
   ```javascript
   body: JSON.stringify({
     wizardData,          // Wrapped object
     lernplanTitle: `Lernplan ${date}`,
     lernplanDescription: '',
   })
   ```

2. **server.js:370-371** - Server erwartet flache Struktur:
   ```javascript
   app.post('/api/wizard/complete', async (req, res) => {
     const wizardData = req.body;  // ‚ùå Erwartet req.body = wizardData direkt
   ```
   Problem: Server liest `req.body.bufferDays` statt `req.body.wizardData.bufferDays`

3. **Response-Mismatch**:
   - server.js:529-536 liefert: `{ success: true, lernplanId, lernplan, ... }`
   - wizard-context.jsx:1167 erwartet: `result.data?.lernplan?.id`
   - **Problem**: Server wrapped NICHT in `data: { ... }`

4. **Fix-Optionen**:
   - Option A (Server): `const wizardData = req.body.wizardData || req.body;` (r√ºckw√§rtskompatibel)
   - Option B (Server): Response mit `data` wrappen: `{ success: true, data: { lernplanId, lernplan, ... } }`

SCOPE-FENCE:
- Erlaubte Dateien/Komponenten:
  - server.js (Zeilen 370-371, 529-536)
- Verboten: Kein Refactor, keine Umbenennungen, keine neuen Dependencies, keine Formatierungs√§nderungen, keine UI √Ñnderungen au√üerhalb des betroffenen Bereichs, keine Logik√§nderungen au√üerhalb des Bugs.

CHANGE-BUDGET:
- Max Dateien: 1 (server.js reicht)
- Max ge√§nderte Zeilen: 20
- API-Contract-√Ñnderung: Response bekommt `data`-Wrapper (r√ºckw√§rtskompatibel da `success` bleibt)

VORGEHEN:
1) server.js:371: `const wizardData = req.body.wizardData || req.body;`
2) server.js:529-536: Response in `data` wrappen
3) Testen: Wizard-Flow durchspielen, `result.data.lernplan.id` pr√ºfen

L√ñSUNG (27.01.2026):
1. **server.js:370-374** - Payload-Handling r√ºckw√§rtskompatibel:
   ```javascript
   // PW-018 FIX: Handle both wrapped and flat payload formats
   const wizardData = req.body.wizardData || req.body;
   const lernplanTitle = req.body.lernplanTitle || wizardData.title || 'Mein Lernplan';
   ```

2. **server.js:533-547** - Response mit data-Wrapper + R√ºckw√§rtskompatibilit√§t:
   ```javascript
   res.json({
     success: true,
     // Backwards compatibility (template/automatic flows read these)
     lernplanId,
     lernplan,
     // New wrapped format (manual flow reads result.data)
     data: { storage: 'local', lernplanId, lernplan, slotsCount, totalBlocks },
     message: `...`,
   });
   ```

AKZEPTANZKRITERIEN:
- ‚úÖ Manual Flow: `result.data?.lernplan?.id` funktioniert
- ‚úÖ Template/Automatic Flows: `result.lernplanId` bleibt kompatibel
- ‚úÖ API-Contract r√ºckw√§rtskompatibel (beide Formate funktionieren)



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-019
TITEL: /api/health fehlt (Health-Check immer false)
TYP: Bug
PRIORIT√ÑT: P2
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist-Zustand: `agentApi.checkHealth` ruft `/api/health` auf, der Endpoint existiert weder in Vercel Functions noch im lokalen Server. Health-Check ist immer false.
- Soll-Zustand: `/api/health` liefert √ºberall `{ success: true }` (200), sodass UI korrekt erkennt, ob der API-Server erreichbar ist.
- Kontext: Wizard (KI-Plan-Generierung), allgemeiner API-Health-Check.

ROOT CAUSE ANALYSE:
1. **api.ts:402-418** - Frontend ruft Health-Check auf:
   ```typescript
   checkHealth: async (): Promise<boolean> => {
     const apiUrl = USE_LOCAL_API
       ? `${LOCAL_API_BASE}/health`   // http://localhost:3010/api/health
       : '/api/health';               // /api/health (Vercel)
     const response = await fetch(apiUrl, { ... });
     return response.ok;  // true wenn 2xx
   }
   ```

2. **server.js** - KEIN `/api/health` Endpoint vorhanden!
   - Suche nach "health" ergibt keine Treffer
   - Ergebnis: 404 ‚Üí `checkHealth` returns false

3. **api/health.ts** - Datei existiert NICHT im api/ Ordner f√ºr Vercel Functions

L√ñSUNG:
- server.js: Einfachen Health-Endpoint hinzuf√ºgen:
  ```javascript
  app.get('/api/health', (req, res) => {
    res.json({ success: true, timestamp: new Date().toISOString() });
  });
  ```
- api/health.ts: Neue Vercel Function erstellen (analog zu bestehenden api/*.ts)

SCOPE-FENCE:
- Erlaubte Dateien/Komponenten:
  - server.js (neuer Endpoint nach Zeile ~85)
  - api/health.ts (neue Datei)
- Verboten: Kein Refactor, keine Umbenennungen, keine neuen Dependencies, keine Formatierungs√§nderungen, keine UI √Ñnderungen au√üerhalb des betroffenen Bereichs, keine Logik√§nderungen au√üerhalb des Bugs.

CHANGE-BUDGET:
- Max Dateien: 2
- Max ge√§nderte Zeilen: 25
- Keine √Ñnderung an API Contracts ohne explizite Erw√§hnung

VORGEHEN:
1) server.js: `app.get('/api/health', ...)` hinzuf√ºgen
2) api/health.ts: Neue Vercel Serverless Function
3) Testen: `curl http://localhost:3010/api/health` ‚Üí `{ success: true }`

L√ñSUNG (27.01.2026):
1. **server.js:83-93** - Neuer Health-Endpoint f√ºr lokalen Dev-Server:
   ```javascript
   app.get('/api/health', (req, res) => {
     res.json({
       success: true,
       timestamp: new Date().toISOString(),
       server: 'local-dev',
     });
   });
   ```

2. **api/health.ts** - Neue Vercel Serverless Function:
   ```typescript
   export default function handler(req: VercelRequest, res: VercelResponse) {
     res.status(200).json({
       success: true,
       timestamp: new Date().toISOString(),
       server: 'vercel',
     });
   }
   ```

AKZEPTANZKRITERIEN:
- ‚úÖ `/api/health` gibt 200 zur√ºck (DEV und PROD)
- ‚úÖ `agentApi.checkHealth` liefert true, wenn Server erreichbar
- ‚úÖ Keine Auswirkungen auf andere Endpoints



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-020
TITEL: Auth-Debug Logging in Produktion deaktivieren
TYP: Bug
PRIORIT√ÑT: P2
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist-Zustand: `AUTH_DEBUG` ist dauerhaft `true` und loggt Auth-Requests inkl. Stacktrace. Risiko: Performance/Privacy in PROD.
- Soll-Zustand: Debug-Logging nur in DEV oder via explizitem Flag aktiv.
- Kontext: Auth (Supabase), globaler fetch-Interceptor.

ROOT CAUSE ANALYSE:
1. **supabase.ts:8** - Hardcoded Debug-Flag:
   ```typescript
   const AUTH_DEBUG = true; // Set to false to disable debug logging
   ```

2. **supabase.ts:10-...** - Interceptor wird immer aktiviert:
   ```typescript
   if (AUTH_DEBUG && typeof window !== 'undefined') {
     const originalFetch = window.fetch;
     window.fetch = async function (...args) {
       // ... logs Auth requests with stacktrace
     };
   }
   ```

3. **Problem**: `AUTH_DEBUG = true` bedeutet:
   - Alle Supabase Auth-Requests werden geloggt (inkl. Tokens!)
   - Stacktraces werden in Console geschrieben
   - Performance-Impact durch Interceptor
   - **Sicherheitsrisiko**: Auth-Headers k√∂nnten in PROD-Logs landen

L√ñSUNG:
```typescript
// Vorher (Zeile 8):
const AUTH_DEBUG = true;

// Nachher:
const AUTH_DEBUG = import.meta.env.DEV || import.meta.env.VITE_AUTH_DEBUG === 'true';
```

SCOPE-FENCE:
- Erlaubte Dateien/Komponenten: src/services/supabase.ts (Zeile 8)
- Verboten: Kein Refactor, keine Umbenennungen, keine neuen Dependencies, keine Formatierungs√§nderungen, keine UI √Ñnderungen au√üerhalb des betroffenen Bereichs, keine Logik√§nderungen au√üerhalb des Bugs.

CHANGE-BUDGET:
- Max Dateien: 1
- Max ge√§nderte Zeilen: 1
- Keine √Ñnderung an API Contracts ohne explizite Erw√§hnung

VORGEHEN:
1) supabase.ts:8 √§ndern zu: `const AUTH_DEBUG = import.meta.env.DEV;`
2) Optional: `|| import.meta.env.VITE_AUTH_DEBUG === 'true'` f√ºr explizites Override
3) Testen: PROD-Build, Console pr√ºfen ob Auth-Logs verschwunden sind

L√ñSUNG (27.01.2026):
**supabase.ts:8** - Ge√§ndert von:
```typescript
const AUTH_DEBUG = true;
```
zu:
```typescript
const AUTH_DEBUG = import.meta.env.DEV;
```

AKZEPTANZKRITERIEN:
- ‚úÖ In PROD keine Auth-Debug-Logs
- ‚úÖ In DEV bleiben Logs verf√ºgbar
- ‚úÖ Keine Auswirkungen auf Auth-Funktionalit√§t



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-021
TITEL: Themenlisten Auswahl zeigt keine Aufgaben und es werden nicht alle Themenlisten gerendert
TYP: Bug
PRIORIT√ÑT: P1
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist-Zustand: Auf der Startseite, links im Themenlisten Toggle, f√ºhrt die Auswahl einer Themenliste dazu, dass √ºberall "keine Aufgaben" angezeigt wird oder ein Platzhalter erscheint, als ob eine Themenliste existieren m√ºsste, aber sie wird nicht gerendert. Es geht sogar soweit das themenlisten angezeigt werden die gar nicht existieren. Insgesamt existieren vier Themenlisten, jedoch wird nur eine korrekt angezeigt. 
- Soll-Zustand: Alle vier Themenlisten von der seite lernpl√§ne werden im Toggle korrekt angezeigt. Beim Ausw√§hlen einer Themenliste werden die zugeh√∂rigen Aufgaben zuverl√§ssig geladen und angezeigt. Keine falschen "keine Aufgaben" Meldungen, solange Aufgaben existieren.
- Kontext: Startseite, linker Sidebar Bereich, Flow: Themenlisten Toggle √∂ffnen, Themenliste ausw√§hlen, Aufgabenbereich aktualisiert sich.

ROOT CAUSE ANALYSE (KORRIGIERT 27.01.2026):

**HAUPTURSACHE: Datenstruktur-Mismatch zwischen Alt und Neu**

Es existieren **zwei verschiedene Datenstrukturen** f√ºr Themenlisten:

1. **ALTE Struktur** (rechtsgebiete-basiert, pre-T27):
   ```
   plan.rechtsgebiete ‚Üí rg.unterrechtsgebiete ‚Üí urg.kapitel ‚Üí k.themen ‚Üí t.aufgaben
   ```

2. **NEUE T27-Struktur** (flach, aktuell):
   ```
   plan.selectedAreas[]    - Ausgew√§hlte Unterrechtsgebiete
   plan.themen[]           - Themen mit aufgaben[]
   plan.kapitel[]          - Optional, wenn useKapitel=true
   plan.useKapitel         - Boolean f√ºr Kapitel-Ebene
   ```

**Der Fehler:**
- **dashboard.jsx:204-272** (`themeLists` useMemo) liest NUR aus der ALTEN Struktur:
  ```javascript
  plan.rechtsgebiete?.forEach(rg => {
    rg.unterrechtsgebiete?.forEach(urg => {
      urg.kapitel?.forEach(k => { ... })
    });
  });
  ```
- **Neue Themenlisten** (erstellt via themenliste-editor.jsx) verwenden die NEUE flache Struktur
- **Ergebnis**: Neue TLs erscheinen im Dropdown, aber `unterrechtsgebiete` Array ist leer ‚Üí "keine Aufgaben"

**Beweise:**
- `src/utils/themenliste-migration.js` enth√§lt `migrateOldToNewStructure()` Funktion
- `src/pages/themenliste-editor.jsx:107-132` pr√ºft und migriert alte Struktur
- `src/hooks/use-supabase-sync.js:673-701` definiert BEIDE Strukturfelder im Transform

**Warum nur 1 von 4 funktioniert:**
- Die eine funktionierende TL wurde mit ALTER Struktur erstellt (hat `rechtsgebiete[]`)
- Die 3 nicht-funktionierenden wurden mit NEUER Struktur erstellt (haben `selectedAreas[]` + `themen[]`)

SCOPE-FENCE:
- Erlaubte Dateien/Komponenten:
  - src/pages/dashboard.jsx (themeLists useMemo, Zeilen 204-272)
  - src/utils/themenliste-migration.js (Import f√ºr Migration)
  - src/contexts/calendar-context.jsx (Migration beim Laden ausf√ºhren)
  - src/hooks/use-supabase-sync.js (rechtsgebiete Feld entfernen nach Migration)
- Verboten: Kein Refactor des themenliste-editor.jsx

CHANGE-BUDGET:
- Max Dateien: 4
- Max ge√§nderte Zeilen: 120
- Alte Datenstruktur (rechtsgebiete) wird nach Migration ENTFERNT

VORGEHEN:

**Phase 1: Migration beim Laden**
1) In `calendar-context.jsx` oder beim Laden von `contentPlans`:
   - Pr√ºfe jeden Plan mit `isOldStructure(plan)`
   - Wenn alt: Automatisch `migrateOldToNewStructure(plan)` ausf√ºhren
   - Migrierte Version in Supabase speichern (√ºberschreibt alte Daten)

**Phase 2: Dashboard auf neue Struktur umstellen**
2) **dashboard.jsx:themeLists** komplett auf NEUE Struktur umstellen:
   ```javascript
   // KEINE Fallback-Logik f√ºr alte Struktur mehr n√∂tig!
   const unterrechtsgebiete = (plan.selectedAreas || []).map(area => {
     const areaThemen = (plan.themen || []).filter(t => t.areaId === area.id);
     return {
       id: area.id,
       name: area.name,
       rechtsgebiet: area.rechtsgebietId,
       rechtsgebietId: area.rechtsgebietId,
       kapitel: [{
         id: `kapitel-${area.id}`,
         title: area.name,
         themen: areaThemen.map(t => ({
           id: t.id,
           title: t.name,
           description: t.description || '',
           completed: t.completed || false,
           aufgaben: (t.aufgaben || []).map(a => ({
             id: a.id,
             title: a.name,
             completed: a.completed || false,
             priority: a.priority || 'none',
             scheduledInBlock: a.scheduledInBlock || null,
           })),
         })),
       }],
     };
   });
   ```

**Phase 3: Alte Struktur entfernen**
3) Nach erfolgreicher Migration:
   - `use-supabase-sync.js`: `rechtsgebiete` Feld aus Transform entfernen
   - Alte `plan.rechtsgebiete` Logik in dashboard.jsx l√∂schen
   - Optional: Supabase-Spalte `rechtsgebiete` deprecaten (sp√§teres Cleanup)

4) Testen mit allen 4 Themenlisten

L√ñSUNG (27.01.2026):

**Phase 1: calendar-context.jsx**
- Import von `isOldStructure`, `migrateOldToNewStructure` hinzugef√ºgt
- useEffect f√ºr Auto-Migration beim Laden (Zeilen 212-254):
  - Pr√ºft alle contentPlans auf alte Struktur
  - Migriert automatisch mit `migrateOldToNewStructure()`
  - Speichert migrierte Daten in Supabase
  - L√§uft nur einmal (migrationRunRef)

**Phase 2: dashboard.jsx**
- `themeLists` useMemo (Zeilen 204-263) komplett umgeschrieben:
  - Liest aus `plan.selectedAreas[]` + `plan.themen[]`
  - Keine Fallback-Logik f√ºr alte Struktur
- `handleToggleThemeListAufgabe` (Zeilen 266-282):
  - Aktualisiert `updatedPlan.themen[]` statt `rechtsgebiete`
- `handleToggleThemaCompleted` (Zeilen 319-336):
  - Findet Thema in `plan.themen[]` statt `rechtsgebiete`

**Phase 3: use-supabase-sync.js**
- `transformToSupabase`: `rechtsgebiete: []` (immer leer)
- `transformFromSupabase`: `rechtsgebiete` Mapping entfernt
- Kommentare: "DEPRECATED - use T27 flat structure"

AKZEPTANZKRITERIEN:
- Alle 4 Themenlisten erscheinen im Dropdown.
- Alle Themenlisten nutzen die NEUE T27-Struktur (keine rechtsgebiete mehr).
- Alte Themenlisten werden automatisch migriert beim ersten Laden.
- Keine "keine Aufgaben" Meldung wenn Aufgaben existieren.
- Keine JavaScript-Fehler in der Console.
- ALTE Datenstruktur (rechtsgebiete) ist aus dem Code entfernt.



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-022
TITEL: Check-ins in User Settings auf "nur abends" begrenzen und optional komplett deaktivieren
TYP: UX
PRIORIT√ÑT: P2

PROBLEM:
- Ist-Zustand: Check-ins lassen sich in den User Settings nicht so konfigurieren, dass sie nur abends stattfinden. Au√üerdem gibt es keine Option, Check-ins vollst√§ndig auszuschalten. Unklar ist zudem, wie sich das auf Mentor Funktionen auswirkt.
- Soll-Zustand: In den User Settings kann der User Check-ins auf "nur abends" stellen und optional komplett deaktivieren. Mentor abh√§ngige Views d√ºrfen dabei nicht kaputtgehen. Falls Mentor auf Check-in Daten angewiesen ist, soll ein klarer Fallback greifen.
- Kontext: User Settings Screen, Bereich Check-ins, Flow: Settings √∂ffnen, Check-in Preferences setzen, App Verhalten im Tagesablauf und im Mentor Bereich beobachten.

ROOT CAUSE ANALYSE:
1. **settings-content.jsx:70-73** - Aktuelle Settings-Struktur:
   ```javascript
   checkin: {
     checkInCount: 2, // 1 = nur Morgen, 2 = Morgen & Abend
   }
   ```
   - Fehlend: Option f√ºr "nur Abend" (z.B. checkInCount: 'evening')
   - Fehlend: Option f√ºr "deaktiviert" (z.B. checkInCount: 0 oder checkInsEnabled: false)

2. **checkin-context.jsx:458-461** - Respektiert checkInCount === 1 f√ºr "Morgen only":
   ```javascript
   if (checkInCount === 1 && currentPeriod === 'evening') {
     return false;
   }
   ```
   - Muss erweitert werden f√ºr "evening only" und "disabled"

3. **Mentor-Abh√§ngigkeiten**:
   - dashboard-sub-header.jsx: Check-in Button sichtbar wenn `isMentorActivated`
   - checkin-context.jsx:447-449: `isCheckInNeeded` setzt `isMentorActivated` voraus
   - Fallback n√∂tig: Mentor-Features ohne Check-in Daten

SCOPE-FENCE:
- Erlaubte Dateien/Komponenten:
  - src/components/settings/settings-content.jsx (UI f√ºr neue Options)
  - src/contexts/checkin-context.jsx (Logik f√ºr neue Modes)
- Verboten: Kein Refactor, keine Umbenennungen, keine neuen Dependencies, keine Formatierungs√§nderungen, keine UI √Ñnderungen au√üerhalb des betroffenen Bereichs, keine Logik√§nderungen au√üerhalb des Bugs.

CHANGE-BUDGET:
- Max Dateien: 2
- Max ge√§nderte Zeilen: 100
- Settings-Schema-√Ñnderung: checkInCount von number zu string|number ('morning', 'evening', 'both', 0)

VORGEHEN:
1) Settings-Schema erweitern: checkInCount Werte: 0 (disabled), 'morning', 'evening', 'both'
2) UI: Dropdown mit 4 Optionen: "Deaktiviert", "Nur Morgen", "Nur Abend", "Morgen & Abend"
3) checkin-context.jsx: isCheckInNeeded Logik f√ºr neue Werte
4) Fallback: Mentor-Views mit leerem Check-in Daten testen

AKZEPTANZKRITERIEN:
- User kann Check-ins auf "nur abends" stellen.
- User kann Check-ins komplett deaktivieren.
- Mentor-abh√§ngige Views funktionieren ohne Absturz bei deaktivierten Check-ins.
- Dashboard Check-in Button verschwindet wenn Check-ins deaktiviert.
- Bestehende "1 Check-in" und "2 Check-ins" Einstellungen bleiben kompatibel.



ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix oder eine kleine UX Anpassung.
TICKET-ID: PW-023
TITEL: Step 15 zeigt "keine Themen" f√ºr √ñffentliches Recht und Strafrecht, obwohl in Step 12 erstellt
TYP: Bug
PRIORIT√ÑT: P1
STATUS: üîß IN ARBEIT - Debug-Logs + Fallback-Fix implementiert (27.01.2026)

PROBLEM:
- Ist-Zustand: In Wizard Step 15 (Lernbl√∂cke erstellen) erscheint f√ºr √ñffentliches Recht und Strafrecht die Meldung "Keine Themen vorhanden. Gehe zur√ºck zu Schritt 12", obwohl der User in Step 12 Themen erstellt hat. Zivilrecht wird korrekt angezeigt.
- Soll-Zustand: Alle in Step 12 erstellten Themen werden in Step 15 f√ºr ALLE Rechtsgebiete korrekt angezeigt.
- Kontext: Lernplan Wizard, manueller Pfad, Steps 12 ‚Üí 14 ‚Üí 15.

HINWEIS ZUM TICKET-TITEL:
Originaltext erw√§hnte "Aufgaben aus Schritt 14" - dies ist INKORREKT:
- Step 14 (step-14-gewichtung.jsx) zeigt NUR Prozent-Gewichtungen, KEINE Themen/Aufgaben
- Themen werden in Step 12 (step-12-themen-edit.jsx) erstellt
- Step 15 (step-15-lernbloecke.jsx) liest Themen aus themenDraft

ROOT CAUSE ANALYSE:

**Datenfluss:**
```
Step 12: Speichert Themen ‚Üí themenDraft[urg.id] = [{ id, name, aufgaben }]
         Liest URGs      ‚Üí unterrechtsgebieteDraft[currentRgId] = [{ id, name }]

Step 15: Liest URGs      ‚Üí unterrechtsgebieteDraft[currentRgId]
         Liest Themen    ‚Üí themenDraft[urg.id]
```

**Step 15 Datenabfrage (step-15-lernbloecke.jsx:451-466):**
```javascript
const allThemesForRg = useMemo(() => {
  const themes = [];
  const urgs = unterrechtsgebieteDraft[currentRgId] || [];  // ‚Üê Potenzielle L√ºcke 1
  urgs.forEach(urg => {
    const urgThemes = themenDraft[urg.id] || [];  // ‚Üê Potenzielle L√ºcke 2
    urgThemes.forEach(theme => {
      themes.push({ ...theme, urgId: urg.id, urgName: urg.name });
    });
  });
  return themes;
}, [currentRgId, unterrechtsgebieteDraft, themenDraft]);
```

**M√∂gliche Root Causes:**

1. **URG-ID-Mismatch (WAHRSCHEINLICHSTE URSACHE)**
   - URGs werden in Step 9 mit dynamischen IDs erstellt: `urg-${Date.now()}`
   - Wenn User zur√ºck zu Step 8/9 navigiert und URGs neu erstellt werden, bekommen sie NEUE IDs
   - Themen sind noch unter ALTEN URG-IDs in `themenDraft` gespeichert
   - Ergebnis: `themenDraft[neue-urg-id]` ist leer, obwohl `themenDraft[alte-urg-id]` Daten hat

2. **unterrechtsgebieteDraft leer f√ºr bestimmte RGs**
   - `unterrechtsgebieteDraft['oeffentliches-recht']` oder `['strafrecht']` k√∂nnten leer sein
   - Ursache: URGs wurden in Step 9 nicht korrekt f√ºr alle RGs gespeichert
   - Debug: `unterrechtsgebieteDraft` Struktur in Step 15 loggen

3. **State-Reset bei Navigation**
   - wizard-context.jsx:599-619: Beim Zur√ºck-Navigieren zu Step 8 werden URG-Daten resettet
   - Wenn User von Step 15 ‚Üí Step 8 zur√ºck geht und wieder vor, werden URGs neu erstellt

**Warning-Messages in Step 15:**
- Zeile 770-776: "Keine Themen vorhanden" wenn `totalAufgaben === 0`
- Zeile 809-813: "Keine Themen vorhanden" wenn `urgsWithThemes.length === 0`

SCOPE-FENCE:
- Erlaubte Dateien:
  - src/features/lernplan-wizard/steps/step-15-lernbloecke.jsx (Debug/Fix)
  - src/features/lernplan-wizard/steps/step-12-themen-edit.jsx (Debug)
  - src/features/lernplan-wizard/steps/step-09-urgs-edit.jsx (URG-ID Stabilit√§t)
  - src/features/lernplan-wizard/context/wizard-context.jsx (State-Reset-Logik)
- Verboten: Kein Refactor, keine Umbenennungen, keine neuen Dependencies

CHANGE-BUDGET:
- Max Dateien: 4
- Max ge√§nderte Zeilen: 60
- Keine Schema-√Ñnderungen an themenDraft/unterrechtsgebieteDraft

VORGEHEN:
1) **Debug-Phase**:
   - Console.log in Step 15: `unterrechtsgebieteDraft`, `themenDraft`, `currentRgId`
   - Pr√ºfen welche RGs leere URG-Arrays haben
   - Pr√ºfen ob themenDraft-Keys mit URG-IDs √ºbereinstimmen

2) **Fix-Strategie A: Stabile URG-IDs**
   - URGs mit deterministischen IDs erstellen: `${rgId}-${urgName.slug}`
   - Verhindert ID-Mismatch bei Wizard-Navigation

3) **Fix-Strategie B: URG-ID-Lookup**
   - Step 15: Themes √ºber URG-Namen suchen statt √ºber IDs
   - Fallback wenn ID-Lookup fehlschl√§gt

4) **Fix-Strategie C: State-Reset verhindern**
   - wizard-context.jsx: Nur URGs resetten wenn explizit gew√ºnscht
   - Bestehende themenDraft-Keys erhalten

AKZEPTANZKRITERIEN:
- Alle in Step 12 erstellten Themen erscheinen in Step 15 f√ºr ALLE Rechtsgebiete
- Keine "Keine Themen vorhanden" Meldung wenn Themen existieren
- Zur√ºck-Navigation (Step 15 ‚Üí Step 12 ‚Üí Step 15) verliert keine Daten
- Wizard-Flow funktioniert f√ºr alle 4 Rechtsgebiete konsistent

IMPLEMENTIERTE L√ñSUNG (27.01.2026):

**Phase 1: Debug-Logging hinzugef√ºgt**
Um die Root Cause genau zu identifizieren, wurden Debug-Logs in 3 Dateien hinzugef√ºgt:

1. **step-9-urgs-edit.jsx**
   - Log bei URG-Initialisierung: currentRechtsgebiet, urgCreationMode, Initial URGs

2. **step-12-themen-edit.jsx**
   - Log bei Theme-Erstellung: activeUrg.id, currentRgId, themenDraft keys
   - Log beim RG-Wechsel: currentRgId, URGs f√ºr dieses RG, alle unterrechtsgebieteDraft keys

3. **step-15-lernbloecke.jsx**
   - Log beim Laden: currentRgId, unterrechtsgebieteDraft keys, URGs, themenDraft keys
   - Log f√ºr jede URG: Name, ID, Anzahl Themes

**Phase 2: Fallback-Fix implementiert (Fix-Strategie D)**
In step-12-themen-edit.jsx wurde ein useEffect hinzugef√ºgt (Zeilen 333-344):
```javascript
useEffect(() => {
  if (currentRgId && !unterrechtsgebieteDraft[currentRgId]) {
    console.log('[PW-023 FIX] Step 12 - Initializing missing URGs for:', currentRgId);
    const fallbackUrgs = DEFAULT_SELECTION[currentRgId] || [];
    updateWizardData({
      unterrechtsgebieteDraft: {
        ...unterrechtsgebieteDraft,
        [currentRgId]: fallbackUrgs
      }
    });
  }
}, [currentRgId, unterrechtsgebieteDraft, updateWizardData]);
```

**Warum dieser Fix:**
- Wenn URGs f√ºr ein RG in Step 9 nicht korrekt initialisiert wurden, werden sie jetzt in Step 12 nachinitialisiert
- Verwendet DEFAULT_SELECTION als Fallback (selbe Datenquelle wie Step 9)
- Loggt wenn die Fallback-Initialisierung ausgel√∂st wird

**N√§chste Schritte:**
1. User soll Wizard durchlaufen und Browser-Konsole pr√ºfen
2. Debug-Logs analysieren um exakte Root Cause zu identifizieren
3. Falls Fallback-Fix nicht ausreicht, weitere Anpassungen basierend auf Logs

**Ge√§nderte Dateien:**
- src/features/lernplan-wizard/steps/step-9-urgs-edit.jsx (Debug-Logs)
- src/features/lernplan-wizard/steps/step-12-themen-edit.jsx (Debug-Logs + Fallback-Fix)
- src/features/lernplan-wizard/steps/step-15-lernbloecke.jsx (Debug-Logs)




ROLE: Du bist Senior Engineer. Ziel ist ein minimaler, risikoarmer Bugfix.

TICKET-ID: PW-024
TITEL: Dashboard crasht mit undefined.map in cleanupExpiredSchedules
TYP: Bug
PRIORIT√ÑT: P0
STATUS: ‚úÖ GEFIXT (27.01.2026)

PROBLEM:
- Ist-Zustand: Dashboard crasht mit "Cannot read properties of undefined (reading 'map')" Fehler
- Soll-Zustand: Dashboard rendert fehlerfrei, auch wenn Supabase-Daten nicht geladen werden konnten
- Kontext: Crash tritt auf nach Supabase 500 Error bei timer_sessions Abfrage

FEHLER-NACHRICHT:
```
Uncaught TypeError: Cannot read properties of undefined (reading 'map')
    at cleanupExpiredSchedules (calendar-context.jsx:2787)
```

ROOT CAUSE ANALYSE:

**Crash-Location: calendar-context.jsx Zeilen 2787-2791**
```javascript
const cleanupExpiredSchedules = useCallback(() => {
  const now = new Date();
  const today = `${now.getFullYear()}-...`;
  let hasChanges = false;

  const updated = contentPlans.map(plan => {  // ‚Üê CRASH 1: contentPlans undefined
    let planChanged = false;
    const updatedPlan = {
      ...plan,
      rechtsgebiete: plan.rechtsgebiete.map(rg => ({  // ‚Üê CRASH 2: rechtsgebiete undefined
```

**Root Cause 1: Fehlende Guard f√ºr contentPlans**
- `contentPlans.map()` wird aufgerufen ohne Pr√ºfung ob contentPlans undefined ist
- Wenn Supabase-Sync fehlschl√§gt, kann contentPlans undefined bleiben

**Root Cause 2: Fehlende Guard f√ºr rechtsgebiete**
- `plan.rechtsgebiete.map()` hat keine Guard
- Interessanterweise sind tiefere Ebenen abgesichert:
  - Zeile 2793: `rg.unterrechtsgebiete || []` ‚úì
  - Zeile 2795: `urg.kapitel || []` ‚úì
  - Zeile 2797: `k.themen || []` ‚úì
  - Zeile 2809: `t.aufgaben || []` ‚úì

**Ausl√∂ser: Supabase 500 Error**
- use-supabase-sync.js Zeile 281-283:
```javascript
} catch (err) {
  console.error(`Error fetching from ${tableName}:`, err);
  return null;  // ‚Üê Gibt null zur√ºck statt leeres Array
}
```
- Wenn Supabase 500 Error zur√ºckgibt, gibt fetchFromSupabase `null` zur√ºck
- Der Aufrufer muss mit null umgehen k√∂nnen

**M√∂gliche Trigger-Szenarien:**
1. Supabase Server-Error (500) bei content_plans oder timer_sessions
2. Netzwerk-Timeout w√§hrend der Datenladung
3. Race Condition beim ersten Laden des Dashboards
4. contentPlans-State noch nicht initialisiert wenn cleanupExpiredSchedules aufgerufen wird

SCOPE-FENCE:
- Erlaubte Dateien:
  - src/contexts/calendar-context.jsx (Guards hinzuf√ºgen)
  - src/hooks/use-supabase-sync.js (Optional: Error-Handling verbessern)
- Verboten: Keine strukturellen √Ñnderungen an contentPlans-Schema
- Verboten: Keine neuen Dependencies

CHANGE-BUDGET:
- Max Dateien: 2
- Max ge√§nderte Zeilen: 15

L√ñSUNG (VORGESCHLAGEN):

**Fix 1: Guards in cleanupExpiredSchedules (Zeile 2781)**
```javascript
const cleanupExpiredSchedules = useCallback(() => {
  // PW-024 FIX: Guard f√ºr undefined/null contentPlans
  if (!contentPlans || !Array.isArray(contentPlans)) {
    return;
  }

  const now = new Date();
  const today = `${now.getFullYear()}-...`;
  let hasChanges = false;

  const updated = contentPlans.map(plan => {
    let planChanged = false;
    const updatedPlan = {
      ...plan,
      // PW-024 FIX: Guard f√ºr undefined rechtsgebiete
      rechtsgebiete: (plan.rechtsgebiete || []).map(rg => ({
```

**Fix 2 (Optional): Defensive Error-Handling in use-supabase-sync.js**
```javascript
} catch (err) {
  console.error(`Error fetching from ${tableName}:`, err);
  return [];  // ‚Üê Leeres Array statt null f√ºr sichereren Fallback
}
```

VORGEHEN:
1) Guards in cleanupExpiredSchedules hinzuf√ºgen
2) Konsistente Guards f√ºr plan.rechtsgebiete
3) Manueller Test: Dashboard laden bei simuliertem Netzwerk-Fehler
4) Optional: Error-Handling in use-supabase-sync verbessern

AKZEPTANZKRITERIEN:
- Dashboard crasht nicht mehr bei undefined contentPlans
- Dashboard crasht nicht mehr bei undefined rechtsgebiete
- Normale Funktionalit√§t bleibt erhalten
- Console zeigt ggf. Warning statt Crash

IMPLEMENTIERTE L√ñSUNG (27.01.2026):

**calendar-context.jsx - cleanupExpiredSchedules (Zeilen 2781-2796)**

1. **Guard f√ºr contentPlans** (Zeile 2782-2785):
```javascript
const cleanupExpiredSchedules = useCallback(() => {
  // PW-024 FIX: Guard f√ºr undefined/null contentPlans
  if (!contentPlans || !Array.isArray(contentPlans)) {
    return;
  }
  // ... rest of function
```

2. **Guard f√ºr rechtsgebiete** (Zeile 2796):
```javascript
// PW-024 FIX: Guard f√ºr undefined rechtsgebiete
rechtsgebiete: (plan.rechtsgebiete || []).map(rg => ({
```

**Ge√§nderte Dateien:**
- src/contexts/calendar-context.jsx (+5 Zeilen)
